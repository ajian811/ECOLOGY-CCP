<!-- script代码，如果需要引用js文件，请使用与HTML中相同的方式。 -->
<script type="text/javascript">
    /*
    *  TODO
     *  请在此处编写javascript代码
     */
var button1='&nbsp&nbsp&nbsp<input name="zh" class="e8_btn_top middle" value="查询" _hasinit="true" style="max-width:';
button1+= '100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="查询" type="button" onclick="searchMX()">';
var button2='&nbsp&nbsp&nbsp<input name="zh" class="e8_btn_top middle" value="清空明细" _hasinit="true" style="max-width:';
button2+= '100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="情空明细" type="button" onclick="delMX()">';
jQuery(".detail0_0_1").append(button1);
//jQuery(".detail0_0_2").append(button2);

function searchMX(){
	delRowFunmd0(0);
	var gh=jQuery("#field10883").val();//柜号
	var ksrq=jQuery("#field10881").val();//开始日期
	var jsrq=jQuery("#field10882").val();//结束日期
	console.log("柜号:"+gh+",开始日期："+ksrq+",结束日期:"+jsrq);
	jQuery.ajax({      
    url: "/sapjsp/VGM1.jsp",      
    data: {"gh":gh,"ksrq":ksrq,"jsrq":jsrq},      
    type: "POST", 
    dataType:"json",     
    success: function (responseJSON) {  
        if(responseJSON){
            console.log(JSON.stringify(responseJSON));
            jQuery.each (responseJSON, function (i, item)  
            {  
              addRow0(0);
              hang_number0=parseInt(jQuery("#indexnum0").val())-1;
              jQuery("#field10884_"+hang_number0).val(item.rq);//日期
              jQuery("#field10884_"+hang_number0+"span").html(item.rq);//日期
              jQuery("#field11102_"+hang_number0).val(item.gh);//柜号
               jQuery("#field11102_"+hang_number0+"span").html(item.gh);
              jQuery("#field11101_"+hang_number0).val(item.id);//柜id
              
              jQuery("#field10886_"+hang_number0).val(item.jz);//净重
              jQuery("#field10886_"+hang_number0+"span").html(item.jz);//净重
              
            });     
        }    
        
    }      
});
}
function delMX(){
	alert("清空明细");
	delRowFunmd0(0);
	
}
//清空明细表0
function deleteAll(){
	delRowFunmd0(0);
}
//清空明细表groupid
function delRowFunmd0(groupid){
		var oTable = jQuery("table#oTable"+groupid);
		var checkObj = oTable.find("input[name='check_node_"+groupid+"']");
		if(checkObj.size()>0){

				var curindex = parseInt($G("nodesnum"+groupid).value);
				var submitdtlStr = $G("submitdtlid"+groupid).value;
				var deldtlStr = $G("deldtlid"+groupid).value;
				checkObj.each(function(){
					var rowIndex = jQuery(this).val();
					var belRow = oTable.find("tr[_target='datarow'][_rowindex='"+rowIndex+"']");
					var keyid = belRow.find("input[name='dtl_id_"+groupid+"_"+rowIndex+"']").val();
					//提交序号串删除对应行号
					var submitdtlArr = submitdtlStr.split(',');
					submitdtlStr = "";
					for(var i=0; i<submitdtlArr.length; i++){
						if(submitdtlArr[i] != rowIndex)
							submitdtlStr += ","+submitdtlArr[i];
					}
					if(submitdtlStr.length > 0 && submitdtlStr.substring(0,1) === ",")
						submitdtlStr = submitdtlStr.substring(1);
					//已有明细主键存隐藏域
					if(keyid != "")
						deldtlStr += ","+keyid;
					//IE下需先销毁附件上传的object对象，才能remove行
					try{
						belRow.find("td[_fieldid][_fieldtype='6_1'],td[_fieldid][_fieldtype='6_2']").each(function(){
							var swfObj = eval("oUpload"+jQuery(this).attr("_fieldid"));
							swfObj.destroy();
						});
					}catch(e){}
					belRow.remove();
					curindex--;
				});
				$G("submitdtlid"+groupid).value = submitdtlStr;
				if(deldtlStr.length >0 && deldtlStr.substring(0,1) === ",")
					deldtlStr = deldtlStr.substring(1);
				$G("deldtlid"+groupid).value = deldtlStr;
				$G("nodesnum"+groupid).value = curindex;
				//序号重排
				oTable.find("input[name='check_node_"+groupid+"']").each(function(index){
					var belRow = oTable.find("tr[_target='datarow'][_rowindex='"+jQuery(this).val()+"']");
					belRow.find("span[name='detailIndexSpan"+groupid+"']").text(index+1);
				});
				oTable.find("input[name='check_all_record']").attr("checked", false);
				//表单设计器，删除行触发公式计算
				triFormula_delRow(groupid);
				try{
					calSum(groupid);
				}catch(e){}

	}
}
</script>
<script type="text/javascript" src="/sapjsp/util.js"></script>

